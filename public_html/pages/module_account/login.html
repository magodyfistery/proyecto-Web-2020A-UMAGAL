<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title> Umagal </title>


    <link rel="stylesheet" type="text/css" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../css/estilos.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script type="text/javascript" src="../../js/main.js"></script>
    <script type="text/javascript" src="../../js/sha256.js"></script>

  </head>
  <body>
    <header>
      <!-- MENU -->
      <nav class="navbar navbar-expand-lg navbar-light">
  			<a class="navbar-brand" href="index.html">
          <h1> UMAGAL </h1>
        </a>
  			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
  			  <span class="navbar-toggler-icon"></span>
  			</button>

  			<div class="collapse navbar-collapse" id="navbarSupportedContent">
          <div class="div-right">
            <ul class="navbar-nav mr-auto">
      				<li class="nav-item">
      				  <a class="nav-link" href="../../index.html">
                  <h5>
                    Artistas
                  </h5>
                </a>
      				</li>
      				<li class="nav-item">
      				  <a class="nav-link" href="../exhibitions.html">
                  <h5> Exhibiciones </h5>
                </a>
      				</li>
      				<li class="nav-item">
                <a class="nav-link" href="../fairs.html">
                  <h5>Ferias</h5>
                </a>
      				</li>
      				<li class="nav-item">
                <a class="nav-link" href="../videos.html">
                  <h5>Videos</h5>
                </a>
      				</li>
              <li class="nav-item">
                <a class="nav-link" href="../galleries.html">
                  <h5>Galerias</h5>
                </a>
      				</li>
              <li class="nav-item">
                <a class="nav-link" href="../contactos.html">
                  <h5>Contactos</h5>
                </a>
      				</li>
              <div style="width: 20px; height: 100%; background-color: black;">

              </div>

              <li class="nav-item li_not_logged_in active">
                <a class="nav-link" href="login.html">
                  <h5><b>Iniciar sesión</b></h5>
                </a>
              </li>
              <li class="nav-item li_not_logged_in">
                <a class="nav-link" href="registration.html">
                  <h5><b>Registrarse</b></h5>

                </a>
              </li>

              <li class="nav-item li_logged_in">
                <a class="nav-link" href="my_account.html">
                  <h5><b>Mi cuenta</b></h5>
                </a>
              </li>

              <li class="nav-item li_logged_in">
                <button class="btn btn-primary" style="color: black;" id="buttonLogOut">
                  <h5><b>Cerrar sesión</b><h5>
                </button>
              </li>

    			  </ul>
          </div>
  			</div>
  		</nav>
      <!-- FIN DE MENU -->

    </header>

    <br><br>

    <form action="http://localhost/web-proyecto-2020A/public_html/api/module_account/auth_and_retrieve_user.php" method="post" id="form_login">
      <div class="form-umagal">
        <br><br>
        <div class="form-group">
          <select class="form-control form-content-lg" name="type">
            <option value="public"> Public </option>
            <option value="artist"> Artist </option>
          </select>
        </div><br>

        <div class="form-group">
          <label for="username">Usuario</label>
          <input class="form-control form-content-lg" type="text" name="username" placeholder="Ingrese el usuario" required>
        </div><br>


        <div class="form-group">
          <label for="password">Contraseña</label>
          <input class="form-control form-content-lg" type="password" name="password"
          placeholder="Ingrese la contraseña" required>
        </div>

        <br><br>
      </div>
      <br><br>
      <div class="center">
        <button class="btn btn-primary" style="color: black;" type="submit">
          Ingresar
        </button>
      </div>

      <br><br>
      <p class="center text-grey">¿No tiene una cuenta? <a href="registration.html">Resgistrarse</a></p>
      <br><br>
    </form>


    <script type="text/javascript" >

      $("#form_login").submit(function(e){
        e.preventDefault()




        var user = {
          username: $('input[name="username"]').val(),
          password: sha256($('input[name="password"]').val()),
          type: $('select[name="type"]').val()
        }

        $.ajax({
          type: "POST",
          url: $(this).attr("action"),
          data: JSON.stringify(user),
          dataType: 'json',
          contentType: "application/json; charset=utf-8",
          beforeSend:function(){
            console.log("Sending", user)
          },
          success: function(response){

            if(response.data != null){



              var user_data = {
                username: user.username,
                type: user.type,
                name: response.data.name,
                date_of_birth: response.data.date_of_birth,
                artistic_name: response.data.artistic_name,
                address: response.data.address,
                contact_phone: response.data.contact_phone

              };

              localStorage.setItem("user_data", JSON.stringify(user_data));
              localStorage.setItem("is_logged_in", "true");

              $(location).attr('href', '../../index.html');

            }else{
              alert(response.SERVER_MESSAGE);
            }
          },
          error: function(){
            console.log("Error")
          },
          timeout: 1000

        })


        return false;
      })

    </script>








  </body>
</html>
